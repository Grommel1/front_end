<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Clan Manager</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  margin: 0;
  font-family: system-ui, Arial, sans-serif;
  background: #0f172a;
  color: #e5e7eb;
}

header {
  padding: 14px;
  text-align: center;
  font-size: 22px;
  font-weight: bold;
}

.tabs, .filters {
  display: flex;
  gap: 6px;
  padding: 8px;
}

.tabs button, .filters button {
  flex: 1;
  padding: 8px;
  border: none;
  border-radius: 8px;
  background: #1e293b;
  color: white;
  cursor: pointer;
}

.tabs button.active,
.filters button.active {
  background: #2563eb;
}

.section {
  padding: 10px;
}

.card {
  background: #020617;
  border-radius: 12px;
  padding: 12px;
  margin-bottom: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.left {
  display: flex;
  align-items: center;
  gap: 10px;
}

.dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
}

.good { background:#22c55e }
.warning { background:#facc15 }
.danger { background:#ef4444 }
.excused { background:#60a5fa }

.small {
  font-size: 12px;
  color: #94a3b8;
}

button.action {
  background: #334155;
  border: none;
  color: white;
  padding: 6px 10px;
  border-radius: 8px;
}
</style>
</head>

<body>

<header>Clan Manager</header>

<div class="tabs">
  <button class="active" onclick="openTab('players', this)">Spieler</button>
  <button onclick="openTab('war', this)">Clankrieg</button>
  <button onclick="openTab('river', this)">Clanreise</button>
  <button onclick="openTab('leaderboard', this)">Ranking</button>
</div>

<div class="filters" id="filters">
  <button class="active" onclick="setFilter('all', this)">Alle</button>
  <button onclick="setFilter('zero', this)">0 K√§mpfe</button>
  <button onclick="setFilter('danger', this)">Inaktiv</button>
  <button onclick="setFilter('excused', this)">Entschuldigt</button>
</div>

<div id="players" class="section"></div>
<div id="war" class="section" style="display:none"></div>
<div id="river" class="section" style="display:none"></div>
<div id="leaderboard" class="section" style="display:none"></div>

<script>
/* üî¥ DEIN BACKEND */
const BACKEND = "http://157.90.175.255:10000";

let players = [];
let war = [];
let river = [];
let leaderboard = [];
let currentFilter = "all";

/* ---------- API ---------- */
async function api(path) {
  try {
    const r = await fetch(BACKEND + path);
    if (!r.ok) return [];
    return await r.json();
  } catch {
    return [];
  }
}

/* ---------- LOAD (FIXED REIHENFOLGE) ---------- */
async function loadAll() {
  players = await api("/players");
  war = await api("/war");
  river = await api("/river");
  leaderboard = await api("/leaderboard");

  drawPlayers();
  drawWar();
  drawRiver();
  drawLeaderboard();
}

/* ---------- TABS ---------- */
function openTab(id, btn) {
  document.querySelectorAll(".tabs button").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");

  ["players","war","river","leaderboard"].forEach(t => {
    document.getElementById(t).style.display = (t === id) ? "block" : "none";
  });

  document.getElementById("filters").style.display =
    id === "players" ? "flex" : "none";
}

/* ---------- FILTER ---------- */
function setFilter(f, btn) {
  currentFilter = f;
  document.querySelectorAll(".filters button").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");
  drawPlayers();
}

/* ---------- PLAYERS ---------- */
function drawPlayers() {
  const el = document.getElementById("players");
  el.innerHTML = "";

  const filtered = players.filter(p => {
    if (currentFilter === "all") return true;
    if (currentFilter === "danger") return p.status === "danger";
    if (currentFilter === "excused") return p.status === "excused";
    if (currentFilter === "zero") {
      const w = war.find(x => x.tag === p.tag);
      return w && w.decksUsed === 0;
    }
    return true;
  });

  filtered.forEach(p => {
    el.innerHTML += `
      <div class="card">
        <div class="left">
          <div class="dot ${p.status}"></div>
          <div>
            <b>${p.name}</b>
            <div class="small">${p.inactiveDays} Tage ‚Ä¢ ${p.role}</div>
          </div>
        </div>
        <button class="action" onclick="excuse('${p.tag}')">‚òëÔ∏è</button>
      </div>
    `;
  });

  if (!filtered.length) {
    el.innerHTML = "<div class='small'>Keine Spieler gefunden</div>";
  }
}

/* ---------- EXCUSE ---------- */
async function excuse(tag) {
  const days = prompt("Wie viele Tage entschuldigen?", "3");
  if (!days) return;

  await fetch(BACKEND + "/excuse", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ tag, days })
  });

  loadAll();
}

/* ---------- WAR ---------- */
function drawWar() {
  const el = document.getElementById("war");
  el.innerHTML = "";

  if (!war.length) {
    el.innerHTML = "<div class='small'>Kein aktiver Clankrieg</div>";
    return;
  }

  war.forEach(p => {
    el.innerHTML += `
      <div class="card">
        <div class="left">
          <div class="dot ${p.status}"></div>
          <div>
            <b>${p.name}</b>
            <div class="small">${p.decksUsed} K√§mpfe ‚Ä¢ ${p.medals} Medaillen</div>
          </div>
        </div>
      </div>
    `;
  });
}

/* ---------- RIVER ---------- */
function drawRiver() {
  const el = document.getElementById("river");
  el.innerHTML = "";

  if (!river.length) {
    el.innerHTML = "<div class='small'>Keine Clanreise aktiv</div>";
    return;
  }

  river.forEach(p => {
    el.innerHTML += `
      <div class="card">
        <div class="left">
          <div class="dot good"></div>
          <div>
            <b>${p.name}</b>
            <div class="small">${p.fame} Fame</div>
          </div>
        </div>
      </div>
    `;
  });
}

/* ---------- LEADERBOARD ---------- */
function drawLeaderboard() {
  const el = document.getElementById("leaderboard");
  el.innerHTML = "";

  if (!leaderboard.length) {
    el.innerHTML = "<div class='small'>Kein Ranking verf√ºgbar</div>";
    return;
  }

  leaderboard.forEach((p, i) => {
    el.innerHTML += `
      <div class="card">
        <b>#${i + 1} ${p.name}</b>
        <div class="small">Score: ${p.score}</div>
      </div>
    `;
  });
}

loadAll();
</script>

</body>
</html>

